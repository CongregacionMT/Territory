<div class="container py-5 campaign-container">
  <div class="text-center mb-5">
    <h1 class="display-4 fw-bold">üì£ Gesti√≥n de Campa√±as</h1>
    <p class="lead text-muted">Inici√°, finaliz√° y hac√© seguimiento a las campa√±as de predicaci√≥n</p>
  </div>

  @if(daysLeft > 0){
    <div class="alert alert-info text-center mb-4 shadow-sm">
      ‚è≥ Quedan <strong>{{ daysLeft }}</strong> d√≠as para finalizar la campa√±a
    </div>
  }

  <!-- Nueva campa√±a -->
  @if(!campaignInProgress()){
    <div class="card shadow-lg border-0 mb-4 campaign-card">
      <div class="card-body">
        <h4 class="text-white">üìù Nueva Campa√±a</h4>
        <form (ngSubmit)="startCampaign()" class="needs-validation">
          <div class="mb-3">
            <label for="campaignName" class="form-label text-white">Nombre de la campa√±a</label>
            <input id="campaignName"
                  type="text"
                  class="form-control"
                  [ngModel]="campaignName()"
                  (ngModelChange)="onNameChange($event)"
                  name="campaignName"
                  required
                  minlength="3">
            @if(nameInvalid()){
              <div class="text-danger mt-2">
                Por favor, escriba un nombre v√°lido (m√≠nimo 3 caracteres).
              </div>
            }
          </div>

          <div class="mb-3">
            <label for="campaignDescription" class="form-label text-white">Descripci√≥n</label>
            <textarea id="campaignDescription" class="form-control" rows="3"
                      [ngModel]="campaignDescription()" (ngModelChange)="campaignDescription.set($event)"
                      name="campaignDescription"></textarea>
          </div>

          <div class="mb-3">
            <label for="campaignEnd" class="form-label text-white">Fecha de finalizaci√≥n</label>
            <input id="campaignEnd"
                  type="date"
                  class="form-control"
                  [ngModel]="campaignEnd()"
                  (ngModelChange)="onDateChange($event)"
                  name="campaignEnd"
                  required>
            @if(dateInvalid()){
              <div class="text-danger mt-2">
                Seleccione una fecha de finalizaci√≥n.
              </div>
            }
          </div>

          <!-- Bot√≥n de iniciar campa√±a -->
          <button type="button" class="btn btn-success w-100 btn-lg" data-bs-toggle="modal" data-bs-target="#confirmStartModal">
            üöÄ Iniciar Campa√±a
          </button>

          <!-- Modal de confirmaci√≥n -->
          <div class="modal fade" id="confirmStartModal" tabindex="-1" aria-labelledby="confirmStartModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content bg-dark text-white">
                <div class="modal-header border-0">
                  <h5 class="modal-title" id="confirmStartModalLabel">‚ö†Ô∏è Confirmar inicio de campa√±a</h5>
                  <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                  Iniciar una nueva campa√±a reiniciar√° todas las manzanas de todos los territorios.
                  <strong>Esta acci√≥n no tiene retorno.</strong>
                  ¬øEst√° seguro de que desea continuar?
                </div>
                <div class="modal-footer border-0">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                  <button type="button" class="btn btn-danger" (click)="confirmStartCampaign()" data-bs-dismiss="modal">S√≠, iniciar</button>
                </div>
              </div>
            </div>
          </div>

        </form>
      </div>
    </div>
  }

  <!-- Progreso campa√±a -->
  @if(campaignInProgress()){
    <div class="card shadow-lg border-0 mb-4 campaign-card">
      <div class="card-body">
        <h4 class="card-title text-white">üìä Progreso de la Campa√±a</h4>

        @if(statsGlobal){
          <div class="mb-4">
            <h5 class="text-white">Progreso Global</h5>
            <div class="progress progress-animated">
              <div class="progress-bar bg-success"
                   [style.width.%]="statsGlobal.percent"
                   role="progressbar">
                {{ statsGlobal.percent }}%
              </div>
            </div>
          </div>
        }

        @for(territorio of territorios() | orderTerritories; track territorio;){
          <div class="mb-3">
            <label class="form-label text-white">{{ territorio.nombre }}</label>
            <div class="progress">
              <div class="progress-bar bg-info text-white"
                   role="progressbar"
                   [style.width.%]="territorio.porcentaje">
                {{ territorio.porcentaje }}%
              </div>
            </div>
          </div>
        }
      </div>
    </div>

    <div class="d-flex gap-3 mb-5">
      <button class="btn btn-danger flex-fill btn-lg" (click)="endCampaign()">Finalizar Campa√±a</button>
    </div>
  }

  <!-- Historial -->
  @if(campaignHistory().length > 0){
    <div class="card shadow-lg border-0 campaign-card">
      <div class="card-body">
        <h4 class="card-title text-white">üìö Historial de Campa√±as</h4>
        <ul class="list-group list-group-flush mt-3">
          @for(history of campaignHistory(); track history;){
            <li class="list-group-item list-group-item-action history-item"
                (click)="goToCampaignDetail(history.id)">
              <div class="text-white">{{ history.nombre }}</div>
              <small class="text-white">{{ history.fecha }}</small>
            </li>
          }
        </ul>
      </div>
    </div>
  }
</div>
